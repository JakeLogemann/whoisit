name: Rust

on:
  workflow_dispatch:
  schedule: [{ "cron": "0 2 * * *" }]
  pull_request:
    branches: [ master ]

env:
  CARGO_TERM_COLOR: always

jobs:
  build:

    runs-on: ubuntu-latest

    steps:

    - name: checkout current branch.
      uses: actions/checkout@v2

    - name: checkout results branch.
      uses: actions/checkout@v2
      with:
        path: results
        ref: results

    - name: build the binary
      run: cargo build --release

    - name: reset the results directory.
      run: rm -vrf ./results/* && echo $GEN_DATE >./results/generated.txt

    - name: run whoisit with default configuration
      run: ./target/release/whoisit config.toml

    - name: commit the generated results.
      run: |
        mv ./target/ip_lists/* ./results/ && cd results
        git config user.name  github-actions
        git config user.email  github-actions@github.com
        git add . && git commit -am "generated by github-actions" && git push -u origin results

#     - name: Build Release
#       run: cargo build --verbose --release

      
