name: Rust

on:
  workflow_dispatch:
  schedule: [{ "cron": "0 2 * * *" }]
  pull_request:
    branches: [ master ]

env:
  CARGO_TERM_COLOR: always

jobs:
  build:

    runs-on: ubuntu-latest

    steps:

    - name: checkout current branch.
      uses: actions/checkout@v2

    - name: checkout results branch.
      uses: actions/checkout@v2
      with:
        path: results
        ref: results

    - name: run with default config.
      run: cargo run

    - run: |
        export GEN_DATE=$(date)
        set -eux
        cd ./results && rm -vrf ./* && echo $GEN_DATE >./generated.txt
        mv ../target/ip_lists/* ./
        git config user.name github-actions
        git config user.email github-actions@github.com
        git add .
        git commit -am "generated by github-actions" && git push -u origin results
        rm -rf ./results

#     - name: Build Release
#       run: cargo build --verbose --release

      
